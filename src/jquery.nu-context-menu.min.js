/**
 * nuContextMenu - jQuery Plugin
 * Copyright (c) 2015, Alex Suyun
 * Copyrights licensed under The MIT License (MIT)
 */

!function(a,b,c,d){"use strict";var e="nuContextMenu",f={hideAfterClick:!1,contextMenuClass:"nu-context-menu",activeClass:"active"},g=function(b,c){this.container=a(b),this.options=a.extend({},f,c),this._defaults=f,this._name=e,this.init()};a.extend(g.prototype,{init:function(){this.options.items&&(this.items=a(this.options.items)),this._buildContextMenu()&&(this._bindEvents(),this._menuVisible=this._menu.hasClass(this.options.activeClass))},_getCallback:function(){return this.options.callback&&"function"==typeof this.options.callback?this.options.callback:function(){}},_buildContextMenu:function(){if(!this.options.menu||"object"!=typeof this.options.menu)return!1;this._menu=a("<div>").addClass(this.options.contextMenuClass).append("<ul>");var b=this.options.menu,c=this._menu.children("ul");return a.each(b,function(b,d){var e;if("separator"===d&&(e=a("<hr>")),d&&"object"==typeof d&&(e=a("<li>").attr("data-key",b).text(" "+d.title),d.icon)){var f=a("<i>").addClass("fa fa-"+d.icon.toString());e.prepend(f)}c.append(e)}),a("body").append(this._menu),!0},_pDefault:function(a){return a.preventDefault(),a.stopPropagation(),!1},_contextMenu:function(b){b.preventDefault();var c=this,d=b.target;if(this._menuVisible||this.options.disable)return!1;var e=this._getCallback(),f=this._menu.children("ul").children("li");return f.off().on("click",function(){var b=a(this).attr("data-key");e(b,d),c.options.hideAfterClick&&c.closeMenu()}),this.openMenu(),this._menu.css({top:b.pageY+"px",left:b.pageX+"px"}),!0},_onMouseDown:function(b){a(b.target).parents("."+this.options.contextMenuClass).length||this.closeMenu()},_bindEvents:function(){this.items?this.container.on("contextmenu",this.options.items,a.proxy(this._contextMenu,this)):this.container.on("contextmenu",a.proxy(this._contextMenu,this)),a(c).on("mousedown",a.proxy(this._onMouseDown,this))},disable:function(){return this.options.disable=!0,!0},destroy:function(){return this.items?this.items.off("contextmenu"):this.container.off("contextmenu"),this._menu.remove(),!0},openMenu:function(){return this._menu.addClass(this.options.activeClass),this._menuVisible=!0,!0},closeMenu:function(){return this._menu.removeClass(this.options.activeClass),this._menuVisible=!1,!0}}),a.fn[e]=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),f=d.data(e);f?"string"==typeof b&&"_"!==b[0]&&"init"!==b&&f[b].apply(f,c):d.data(e,new g(this,b))})}}(jQuery,window,document);